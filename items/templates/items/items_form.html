{% extends 'items/base.html' %}

{% load static %}
{% load crispy_forms_tags %}

{% block title %}Cadastro de Itens{% endblock %}
{% block stylesheet %}
  <link rel="stylesheet" href="{% static 'css/items_form.css' %}">
{% endblock %}

{% block content %} 
  <div class="container">
    {% if items.pk %}
      <h1>Editar Item</h1>
    {% else %}
      <h1>Novo Item</h1>
    {% endif %}
    <form method="POST">
      {% csrf_token %}
      {{ form|crispy }}
      <button type="submit" class="btn btn-save">Salvar</button>
      <a href="{% url 'items_main' %}" class="btn btn-cancelar">Cancelar</a>
    </form>
  </div>
  <script type="text/javascript">
    $(document).ready(function() {
      $('#id_category').change(function() {
        var category = $(this).val();
        $.ajax({
          url: '{% url "ajax-load-subcategories" %}',
          data: {'category': category},
          success: function(data) {
            var $subCategory = $('#id_sub_category');
            $subCategory.empty();
            {% comment %} $subCategory.append('<option value="">Selecione</option>'); {% endcomment %}
            $.each(data, function(index, value) {
              $subCategory.append($('<option></option>').attr('value', value).text(value));
            });
          }
        });
      });

      var initialCategory = $('#id_category').val();
      if (initialCategory) {
        $.ajax({
          url: '{% url "ajax-load-subcategories" %}',
          data: {'category': initialCategory},
          success: function(data) {
            var $subCategory = $('#id_sub_category');
            $subCategory.empty();
            $subCategory.append('<option value="">Selecione</option>');
            $.each(data, function(index, value) {
              $subCategory.append('<option value="' + value + '">' + value + '</option>');
            });
          }
        });
      }
    });
  </script>
{% endblock %}

